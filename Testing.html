<html>
    <head>
        <meta description="Stock hue cycle."/>
        <meta publisher="WhirlwindFX" />
        <meta property="speed" label="Cycle Speed" type="number" min="1" max="10" default="2">
    </head>
        
    <body style="margin: 0; padding: 0;">
        <canvas id="exCanvas" style="width: 100%; height: 100%"></canvas>
    </body>
        
    <script type="text/javascript" src="./engine.js"></script>
    <script>
      const baseFrame = []
      updatePixels([2], [255, 0, 255], baseFrame)
      updatePixels([0, 1, 3, 4, 5, 6, 7], [0, 0, 0], baseFrame)
      // Sets how many miliseconds to wait between calculating new frames, in interpolates for values before this range
      const nextFrameThreshold = 350
      const calculateNewAnimationState = (animationState) => {
          const nextFrame = []
          const prevFrame = animationState.oldFrame
          const updateNextFrame = (ids, rgb) => updatePixels(ids, rgb, nextFrame)
          let reverse = animationState.extraFields.reverse
          if(!reverse) {
              updateNextFrame([2], prevFrame[6])
              updateNextFrame([1], [prevFrame[2][0], 0, 0])
              updateNextFrame([3], [0, 0, prevFrame[2][2]])
              updateNextFrame([0], prevFrame[1])
              updateNextFrame([4], prevFrame[3])
              updateNextFrame([5], prevFrame[4])
              updateNextFrame([7], prevFrame[0])
              updateNextFrame([6], [prevFrame[7][0], 0, prevFrame[5][2]])
              if (nextFrame[6][0] !== 0) {
                  reverse = true
              }
          } else {
              updateNextFrame([6], prevFrame[2])
              updateNextFrame([5], [prevFrame[6][0], 0, 0])
              updateNextFrame([7], [0, 0, prevFrame[6][2]])
              updateNextFrame([1], prevFrame[0])
              updateNextFrame([3], prevFrame[4])
              updateNextFrame([4], prevFrame[5])
              updateNextFrame([0], prevFrame[7])
              updateNextFrame([2], [prevFrame[1][2], 0, prevFrame[3][0]])
              if (nextFrame[2][0] !== 0) {
                  reverse = false
              }
          }

          return {...animationState, nextFrame, extraFields: {...animationState.extraFields, reverse}}
      }
      const interpolationStart = 0.1
      let update = initEngine(baseFrame, nextFrameThreshold, interpolationStart, calculateNewAnimationState)

      window.requestAnimationFrame(update)
    </script>
</html>
